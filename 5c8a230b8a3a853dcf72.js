import"../style.css";import folderIcon from"../components/icons/folder.svg";import editIcon from"../components/icons/edit.svg";import deleteIcon from"../components/icons/delete.svg";import Controller from"./controller";import Task from"./task";const themeButton=document.querySelector("#toggle-theme"),modalContainer=document.querySelector(".modal-container"),projectsContainer=document.querySelector(".projects");let projects=document.querySelectorAll(".project-container");const newProjectButton=document.querySelector("#add-new-project"),projectCreateModal=document.querySelector(".create-project-modal"),closeProjectCreateModal=document.querySelector("#close-project-creation-modal"),projectForm=document.querySelector(".project-details"),projectEditModal=document.querySelector(".edit-project-modal"),closeProjectEditModal=document.querySelector("#close-project-editing-modal"),editProjectForm=document.querySelector(".edit-project-details"),tasksContainer=document.querySelector(".tasks");let tasks=document.querySelectorAll(".task-container");const newTaskButton=document.querySelector("#add-new-task"),taskCreateModal=document.querySelector(".create-task-modal"),closeTaskCreateModal=document.querySelector("#close-task-creation-modal"),taskForm=document.querySelector(".task-details"),taskEditModal=document.querySelector(".edit-task-modal"),closeTaskEditModal=document.querySelector("#close-task-editting-modal"),editTaskForm=document.querySelector(".edit-task-details"),controller=new Controller,sidebar=document.querySelector(".sidebar"),container=document.querySelector(".container"),sidebarCollapseButtons=document.querySelectorAll("#sidebar-collapse");sidebarCollapseButtons.forEach((e=>{e.addEventListener("click",(()=>{sidebar.classList.toggle("collapse"),container.classList.toggle("expand-content")}))})),document.addEventListener("DOMContentLoaded",(()=>{if(controller.loadDataFromLocalStorage(),0===controller.projects.length){const e=controller.createProject("Demo Project","This is a demo project.");controller.createTask(e,new Task("Demo Task","This is a demo task.","High","2025-12-05")),projectManager.setProjectAsActive(e,projectManager.renderProject(e))}else controller.projects.forEach((e=>{e===controller.activeProject?projectManager.setProjectAsActive(e,projectManager.renderProject(e)):projectManager.renderProject(e)}))}));const themeManager=function(){let e=!1;"true"===localStorage.getItem("isDarkMode")&&(e=!0,document.body.classList.add("dark-theme")),themeButton.addEventListener("click",(()=>{e=!e,localStorage.setItem("isDarkMode",e),document.body.classList.toggle("dark-theme")}))}(),ModalManager=(newProjectButton.addEventListener("click",(()=>{document.querySelector("#project-name-input").value="",document.querySelector("#project-description-input").value="",modalContainer.classList.add("active"),projectCreateModal.classList.add("active")})),closeProjectCreateModal.addEventListener("click",(()=>{modalContainer.classList.remove("active"),projectCreateModal.classList.remove("active")})),document.querySelector("#task-name-input").value="",document.querySelector("#task-description-input").value="",newTaskButton.addEventListener("click",(()=>{modalContainer.classList.add("active"),taskCreateModal.classList.add("active")})),closeTaskCreateModal.addEventListener("click",(()=>{modalContainer.classList.remove("active"),taskCreateModal.classList.remove("active")})),closeProjectEditModal.addEventListener("click",(()=>{modalContainer.classList.remove("active"),projectEditModal.classList.remove("active")})),void closeTaskEditModal.addEventListener("click",(()=>{modalContainer.classList.remove("active"),taskEditModal.classList.remove("active")}))),taskManager=function(){let e;function t(t){const c=document.createElement("div");c.classList.add("task-container"),c.id=t.taskId,c.addEventListener("click",(()=>{o(t,c)}));const r=document.createElement("div");r.classList.add("left");const n=document.createElement("div");n.classList.add("top");const a=document.createElement("div");a.classList.add("left");const s=document.createElement("h3");s.innerText=t.name,a.appendChild(s);const d=document.createElement("div");d.classList.add("right");const i=document.createElement("input");i.type="checkbox",i.name="task-complete",i.id="task-complete",i.classList.add("task-complete"),i.checked=t.isComplete,i.addEventListener("click",(e=>{e.stopPropagation(),controller.activeProject.completeTask(t.taskId),controller.saveToLocalStorage()})),d.appendChild(i),n.append(a,d);const l=document.createElement("div");l.classList.add("bottom");const u=document.createElement("p");u.classList.add("task-description"),u.innerText=t.description,l.appendChild(u),r.append(n,l);const m=document.createElement("div");m.classList.add("seperator");const p=document.createElement("div");p.classList.add("right");const v=document.createElement("div");v.classList.add("wrapper");const k=document.createElement("div");k.classList.add("left");const j=document.createElement("label");j.setAttribute("for","task-priority"),j.innerText="Priority:";const L=document.createElement("p");L.name="priority",L.id="task-priority",L.innerText=t.priority,k.append(j,L);const y=document.createElement("div");y.classList.add("right");const E=document.createElement("label");E.setAttribute("for"," due-date"),E.innerText="DueDate:";const S=document.createElement("p");S.id="due-date",S.innerText=t.getFormattedDate(),y.append(E,S),v.append(k,y);const q=document.createElement("div");q.classList.add("action-buttons");const C=document.createElement("button");C.type="button",C.id="edit-task";const g=document.createElement("img");g.classList.add("edit-task-icon"),g.classList.add("icon"),g.src=editIcon,C.appendChild(g),C.addEventListener("click",(o=>{o.stopPropagation(),e=t,document.querySelector("#edit-task-name-input").value=t.name,document.querySelector("#edit-task-description-input").value=t.description,document.querySelector("#edit-task-priority-input").value=t.priority,document.querySelector("#edit-task-due-date-input").value=t.dueDate,modalContainer.classList.add("active"),taskEditModal.classList.add("active")}));const h=document.createElement("button");h.type="button",h.id="delete-task";const f=document.createElement("img");return f.classList.add("delete-task-icon"),f.classList.add("icon"),f.src=deleteIcon,h.appendChild(f),h.addEventListener("click",(()=>{controller.deleteTask(t,controller.activeProject),tasksContainer.removeChild(c)})),q.append(C,h),p.append(v,q),c.append(r,m,p),tasksContainer.appendChild(c),tasks=document.querySelectorAll(".task-container"),c}function o(e,t){tasks.forEach((e=>{e.classList.remove("active")})),controller.setActiveTask(e),t.classList.add("active")}return taskForm.addEventListener("submit",(e=>{e.preventDefault();const c=document.querySelector("#task-name-input").value,r=document.querySelector("#task-description-input").value,n=document.querySelector("#task-priority-input").value,a=document.querySelector("#task-due-date-input").value,s=new Task(c,r,n,a);controller.createTask(controller.activeProject,s),o(s,t(s)),document.querySelector("#task-name-input").value="",document.querySelector("#task-description-input").value="",document.querySelector("#task-priority-input").value="High",document.querySelector("#task-due-date-input").value="",modalContainer.classList.remove("active"),taskCreateModal.classList.remove("active")})),editTaskForm.addEventListener("submit",(t=>{t.preventDefault();const o=document.querySelector("#edit-task-name-input").value,c=document.querySelector("#edit-task-description-input").value,r=document.querySelector("#edit-task-priority-input").value,n=document.querySelector("#edit-task-due-date-input").value;controller.editTask(e.taskId,o,c,r,n),modalContainer.classList.remove("active"),taskEditModal.classList.remove("active"),function(e,t,o,c){let r;tasks.forEach((t=>{t.id==e.taskId&&(r=t)})),r.querySelector("h3").innerText=t,r.querySelector(".task-description").innerText=o,r.querySelector("#task-priority").innerText=c,r.querySelector("#due-date").innerText=e.getFormattedDate()}(e,o,c,r)})),{renderTask:t}}(),projectManager=function(){let e;function t(t){const c=document.createElement("div");c.classList.add("project-container"),c.id=t.projectId,c.addEventListener("click",(()=>{o(t,c)}));const r=document.createElement("img");r.classList.add("project-icon"),r.classList.add("icon"),r.src=folderIcon;const n=document.createElement("div");n.classList.add("left");const a=document.createElement("p");a.innerText=t.name,n.appendChild(a);const s=document.createElement("div");s.classList.add("right");const d=document.createElement("button");d.id="edit-project";const i=document.createElement("img");i.classList.add("edit-project-icon"),i.classList.add("icon"),i.src=editIcon,d.appendChild(i),d.addEventListener("click",(o=>{o.stopPropagation(),e=t,document.querySelector("#edit-project-name-input").value=t.name,document.querySelector("#edit-project-description-input").value=t.description,modalContainer.classList.add("active"),projectEditModal.classList.add("active")}));const l=document.createElement("button");l.id="delete-project";const u=document.createElement("img");return u.classList.add("delete-project-icon"),u.classList.add("icon"),u.src=deleteIcon,l.appendChild(u),l.addEventListener("click",(e=>{e.stopPropagation(),controller.projects.length>1&&t===controller.activeProject?(function(e){let t=controller.projects[0];controller.projects.length>1&&null!=controller.projects[e]?t=controller.projects[e]:controller.projects.length>1&&(t=controller.projects[e-1]);o(t,document.querySelector(`#${t.projectId}`))}(controller.deleteProject(t)),projectsContainer.removeChild(c)):controller.projects.length>1?(controller.deleteProject(t),projectsContainer.removeChild(c)):alert("There must be at least one project")})),s.append(d,l),c.append(r,n,s),projectsContainer.appendChild(c),projects=document.querySelectorAll(".project-container"),c}function o(e,t){projects.forEach((e=>{e.classList.remove("active")})),controller.setActiveProject(e.projectId),t.classList.add("active"),function(){const e=document.querySelector(".tasks");for(;e.firstChild;)e.firstChild.remove()}(),c(e.name,e.description),0!=e.tasks.length&&function(e){e&&e.tasks.forEach((e=>{taskManager.renderTask(e)}))}(e)}function c(e,t){document.querySelector(".project-title").innerText=e,document.querySelector(".project-description").innerText=t}return projectForm.addEventListener("submit",(e=>{e.preventDefault();const c=document.querySelector("#project-name-input").value,r=document.querySelector("#project-description-input").value,n=controller.createProject(c,r);o(n,t(n)),document.querySelector("#project-name-input").value="",document.querySelector("#project-description-input").value="",modalContainer.classList.remove("active"),projectCreateModal.classList.remove("active")})),editProjectForm.addEventListener("submit",(t=>{t.preventDefault();const o=document.querySelector("#edit-project-name-input").value,r=document.querySelector("#edit-project-description-input").value;controller.editProject(e.projectId,o,r),modalContainer.classList.remove("active"),projectEditModal.classList.remove("active"),function(e,t,o){let r;projects.forEach((t=>{t.id==e.projectId&&(r=t)})),r.querySelector("p").innerText=t,e===controller.activeProject&&c(t,o)}(e,o,r)})),{setProjectAsActive:o,renderProject:t}}();